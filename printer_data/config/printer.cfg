# q2

[include macros/*]
[include mmu/base/*.cfg]
[include MCU_ID.cfg]
[include mainsail.cfg]

[mcu]
serial:/dev/serial/by-id/usb-Klipper_QIDI_MAIN_V2_1.0.4_2A6132373534350734343539-if00
restart_method: command

[mcu TH]
serial: /dev/ttyS4
restart_method: command
baud: 500000


#[save_variables] 
#filename =/home/mks/printer_data/config/saved_variables.cfg

[printer]
kinematics:corexy
max_velocity: 600
max_accel: 20000
max_z_velocity: 20
max_z_accel: 500
square_corner_velocity: 8

[resonance_tester]
accel_per_hz: 150
max_smoothing:0.25
accel_chip:lis2dw
probe_points:
   135, 135, 10


[duplicate_pin_override]
pins:
  TH:PA11



[bed_screws]

screw1:30,30
screw1_name: Front left
screw2: 240,30
screw2_name: Front right
screw3: 240,240
screw3_name: Last right
screw4: 30,240


[force_move]
enable_force_move : True


[extruder]
step_pin:TH:PB9
dir_pin:!TH:PB8
enable_pin:!TH:PC15
rotation_distance: 53.7  #22.6789511 Bondtech 5mm Drive Gears
gear_ratio: 1517:170
microsteps: 16
full_steps_per_rotation: 200	#200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.400
filament_diameter: 1.75
min_temp: 0
max_temp: 375
min_extrude_temp: 175
smooth_time: 0.000001
heater_pin:TH:PB15
sensor_type:MAX6675
sensor_pin:TH:PB12
# spi_speed: 100000
# spi_software_sclk_pin:THR:PB13
# spi_software_mosi_pin:THR:PA15
# spi_software_miso_pin:THR:PB14
spi_bus:spi2
spi_speed:2000000
max_power: 1

control : pid  
pid_Kp=33.555
pid_Ki=4.76
pid_Kd=59.141

pressure_advance: 0.032
pressure_advance_smooth_time: 0.03
max_extrude_cross_section:500
instantaneous_corner_velocity: 10.000
max_extrude_only_distance: 1000.0
max_extrude_only_velocity:5000
max_extrude_only_accel:5000


[tmc2209 extruder]
uart_pin:TH:PC13
interpolate: True
run_current: 0.857
stealthchop_threshold: 0

[lis2dw]
cs_pin:TH:PA10
spi_software_sclk_pin:TH:PA5
spi_software_mosi_pin:TH:PA7
spi_software_miso_pin:TH:PA6
axes_map: y, z, -x





[stepper_x]
step_pin:PB4
dir_pin:!PB3
enable_pin:!PB5
microsteps:16
rotation_distance: 38.82
full_steps_per_rotation:200  
endstop_pin:tmc2240_stepper_x:virtual_endstop
position_min: -1
position_endstop: 271
position_max:275
homing_speed:50
homing_retract_dist:0
homing_positive_dir:true
#step_pulse_duration:0.0000001

[stepper_y]
step_pin:PC14
dir_pin:!PC13
enable_pin:!PC15
microsteps: 16
rotation_distance: 38.82
full_steps_per_rotation:200  
endstop_pin:tmc2240_stepper_y:virtual_endstop
position_min: -1
position_endstop: -1
position_max: 295
homing_speed:50
homing_retract_dist:0
homing_positive_dir:False
#step_pulse_duration:0.0000001

[stepper_z]
step_pin:PC10
dir_pin:PA15
enable_pin:!PC11
microsteps: 128
rotation_distance: 4
full_steps_per_rotation: 200
endstop_pin:probe:z_virtual_endstop 
#position_endstop:0
position_max:265
position_min: -2
homing_speed: 10
second_homing_speed: 5
homing_retract_dist: 10.0
homing_positive_dir:false
#step_pulse_duration:0.0000001

[stepper_z1]
step_pin:PB1
dir_pin:PB6
enable_pin:!PB0
microsteps: 128
rotation_distance: 4
full_steps_per_rotation: 200
#step_pulse_duration:0.0000001


[z_tilt]
z_positions:
    -15,137
    285,137

points:
    10,137
    260,137

speed: 150
horizontal_move_z: 5
retries: 2
retry_tolerance: 0.05


[tmc2240 stepper_x]
spi_software_sclk_pin:PA5
spi_software_miso_pin:PA6
spi_software_mosi_pin:PA7
spi_speed:200000
cs_pin:PC12
diag0_pin:!PB8
interpolate:true
run_current: 1.07
stealthchop_threshold:0
driver_SGT:1
#driver_SLOPE_CONTROL:2



[tmc2240 stepper_y]
spi_software_sclk_pin:PA5
spi_software_miso_pin:PA6
spi_software_mosi_pin:PA7
spi_speed:200000
cs_pin:PD2
diag0_pin:!PC0
interpolate:true
run_current: 1.07
stealthchop_threshold:0
driver_SGT:1
#driver_SLOPE_CONTROL:2

[tmc2209 stepper_z1]
uart_pin: PB7
run_current: 1.07
#hold_current: 0.17
interpolate: True
stealthchop_threshold: 9999999999
diag_pin:^PA14
driver_SGTHRS:140

[tmc2209 stepper_z]
uart_pin: PC5
run_current: 1.07
#hold_current: 0.17
interpolate: True
stealthchop_threshold: 9999999999
diag_pin:^PC1
driver_SGTHRS:140

[heater_bed]
heater_pin: PC7
sensor_type:NTC 100K MGB18-104F39050L32
sensor_pin: PA4
max_power: 1.0
control = pid
# pid_Kp=63.418 
# pid_Ki=1.342 
# pid_Kd=749.125
pid_Kp=71.231 
pid_Ki=1.218 
pid_Kd=1041.758
pwm_cycle_time:0.1
min_temp: -60
max_temp: 125

[heater_generic chamber]
heater_pin:PC8
max_power:1
sensor_type:NTC 100K MGB18-104F39050L32
sensor_pin:PA1

control = pid
pid_Kp=63.418 
pid_Ki=1.342 
pid_Kd=749.125

min_temp:-100
max_temp:70
z_max_limit:230

[verify_heater chamber]
max_error: 300
check_gain_time:480
hysteresis: 5
heating_gain: 1


[temperature_sensor Chamber_Thermal_Protection_Sensor]
sensor_type:NTC 100K MGB18-104F39050L32
sensor_pin:PA2
min_temp:-100
max_temp:130

[verify_heater extruder]
max_error: 120
check_gain_time:20
hysteresis: 2
heating_gain: 2

[verify_heater heater_bed]
max_error: 400
check_gain_time:120
hysteresis: 2
heating_gain: 1

[fan_generic chamber_circulation_fan]
pin: PA10
shutdown_speed: 0.0
cycle_time: 0.0100
hardware_pwm: false
kick_start_time: 0.100
off_below: 0.0


[controller_fan chamber_fan]
pin:PB14
max_power: 1.0
shutdown_speed: 0
kick_start_time: 0.5
heater:chamber
fan_speed: 1.0
off_below: 0
tachometer_pin:PC6
tachometer_ppr: 2
tachometer_poll_interval: 0.0015
stepper:



[heater_fan hotend_fan]
pin:TH:PA11
max_power: 1.0
shutdown_speed:1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0
fan_speed: 1.0
off_below: 0
tachometer_pin:TH:PA12
tachometer_ppr: 2
tachometer_poll_interval: 0.0015


[fan_generic cooling_fan]
pin:TH:PA8
max_power: 1.0
shutdown_speed:0
cycle_time: 0.010
hardware_pwm: False
kick_start_time: 0.100
off_below: 0.0
tachometer_pin:TH:PA9
tachometer_ppr: 2
tachometer_poll_interval: 0.0015

[controller_fan board_fan]
pin:PA9
max_power:1.0
shutdown_speed:1.0
cycle_time:0.01
fan_speed: 1.0
stepper:stepper_z,stepper_z1



[fan_generic auxiliary_cooling_fan]
pin:PB15
shutdown_speed: 0.0
cycle_time: 0.0100
hardware_pwm: false
kick_start_time: 0.100
off_below: 0.0
tachometer_pin:PC4
tachometer_ppr: 2
tachometer_poll_interval: 0.0015



[output_pin Polar_cooler]
pin: PB10
pwm: false
shutdown_value:0
value:0

[output_pin beeper]
pin:PC2
pwm: false
shutdown_value:0
value:0

[output_pin caselight]
pin:PC9
pwm: false
shutdown_value:0
value:1

[probe_air]
sensor_type: c_sensor
sclk_pin: TH:PB3
dout_pin: TH:PB4

voltage: 4.95
delta_v: 0.08
z_offset:-0.07
speed: 5
lift_speed:5
samples: 2
sample_retract_dist:3
samples_result: average
samples_tolerance: 0.02
samples_tolerance_retries: 10



[bed_mesh]
speed: 100 #100
horizontal_move_z:5
mesh_min:10,10
mesh_max:260,260  
probe_count:6,6
algorithm:lagrange#bicubic
#bicubic_tension:0.2
mesh_pps: 2, 2
#fade_target:0
adaptive_margin: 5



[pause_resume]

[display_status]

[exclude_object]

[virtual_sdcard]
path: ~/printer_data/gcodes

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 82.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 51.0
