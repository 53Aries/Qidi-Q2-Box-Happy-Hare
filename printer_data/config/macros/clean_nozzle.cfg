[gcode_macro CLEAN_NOZZLE]
variable_x1: 114
variable_x2: 100
variable_f: 5000
variable_count: 5

gcode:
    {% set vars = printer["gcode_macro CLEAN_NOZZLE"] %}
    {% set count = vars.count | int %}
    {% set hotendtemp = params.HOTEND|default(250)|int %}
    PURGE_PARK
    M400
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET={hotendtemp}
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM={hotendtemp}
    M400
    M106 S255
    G4 P1000
    M104 S150
    {% for i in range(count) %}
        G1 X{vars.x1} F{vars.f}
        G1 X{vars.x2} F{vars.f}
    {% endfor %}

    G90
    G1 Z10 F600
    G1 X125 F15000
    G1 X130 Y280 F6000
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET=150
    M106 S255
    TEMPERATURE_WAIT SENSOR=extruder MAXIMUM=155
    
    G1 Z-0.2 F600

  
    G2 I0.5 J0.5 F600
    G2 I0.5 J0.5 F600
    G2 I0.5 J0.5 F600
    G1 X140 F200
    G1 Y281 F200
    G1 X130 F200
    G1 Y283 F200
    G1 X140 F200

    G2 I0.5 J0.5 F600
    G2 I0.5 J0.5 F600
    G2 I0.5 J0.5 F600

    G1 Z1
    G1 X180 F12000
    G1 Z-1.5
    G1 X164 F12000
    G1 X180 F12000
    G1 X164 F12000
    G1 X180 F12000
    G1 X164 F12000
    G1 X180 F12000
    G1 X164 F12000
    G1 Y284 F12000
    G1 X180 F12000
    G1 X164 F12000
    G1 X180 F12000
    G1 X164 F12000
    G1 X180 F12000
    G1 X164 F12000
    M400
    M118 Nozzle cleaned
    G1 Z30 F900
    M106 S0

[gcode_macro CLEAN_NOZZLE_PRE]
variable_x1: 114
variable_x2: 100
variable_f: 5000
variable_count: 5
gcode:
  {% set hotendtemp = params.HOTEND|default(250)|int %}
  
  G28 Y X
  SET_KINIMATIC_POSITION Z=1
  PURGE_PARK
  SET_HEATER_TEMPERATURE HEATER=extruder TARGET={hotendtemp}
  {% for i in range(count) %}
      G1 X{vars.x1} F{vars.f}
      G1 X{vars.x2} F{vars.f}
  {% endfor %}
  G1 X125 F15000
