[gcode_macro PRINT_START]
gcode:
    {% set bedtemp = params.BED|default(0)|int %}
    {% set hotendtemp = params.HOTEND|default(0)|int %}
    {% set chambertemp = params.CHAMBER|default(0)|int %}
    
    CLEAR_PAUSE
    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bedtemp}
    SET_HEATER_TEMPERATURE HEATER=chamber TARGET={chambertemp}
    {% if chambertemp != 0 %}
      SET_FAN_SPEED FAN=auxiliary_cooling_fan SPEED=0.5
    {% endif %}
    TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={bedtemp - 2}
    TEMPERATURE_WAIT SENSOR="heater_generic chamber" MINIMUM={chambertemp - 2}
    SET_FAN_SPEED FAN=auxiliary_cooling_fan SPEED=0
    G28
    CLEAN_NOZZLE HOTEND={hotendtemp}
    SET_GCODE_OFFSET Z=0 MOVE=0
    G28 Z
    Z_TILT_ADJUST
    G28 Z
    BED_MESH_CALIBRATE PROFILE=adaptive ADAPTIVE=1
    G90
    G1 Z20
    set_zoffset
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET={hotendtemp}
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM={hotendtemp - 2} MAXIMUM={hotendtemp + 5}